@page
@model OnlineEnrolmentSystem.Pages.Account.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">

            @if (TempData["StatusMessage"] is string status && !string.IsNullOrWhiteSpace(status))
            {
                <div class="alert alert-success">@status</div>
            }

            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <!-- Card -->
            <div class="card shadow-lg border-0 rounded-3">
                <div class="card-header bg-info text-white text-center">
                    <h4 class="mb-0">Change Password</h4>
                </div>
                <div class="card-body p-4">
                    <form method="post">
                        <!-- Old Password -->
                        <div class="mb-3">
                            <label asp-for="Input.OldPassword" class="form-label fw-semibold"></label>
                            <div class="input-group">
                                <input asp-for="Input.OldPassword" type="password" autocomplete="current-password" class="form-control" />
                                <button type="button" class="btn btn-outline-secondary toggle-password"
                                        data-target="Input_OldPassword" aria-label="Show password">
                                    <span class="eye-open" aria-hidden="true">👁️</span>
                                    <span class="eye-closed d-none" aria-hidden="true">🙈</span>
                                </button>
                            </div>
                            <span asp-validation-for="Input.OldPassword" class="text-danger small"></span>
                        </div>

                        <!-- New Password -->
                        <div class="mb-3">
                            <label asp-for="Input.NewPassword" class="form-label fw-semibold"></label>
                            <div class="input-group">
                                <input asp-for="Input.NewPassword" type="password" autocomplete="new-password" class="form-control" />
                                <button type="button" class="btn btn-outline-secondary toggle-password"
                                        data-target="Input_NewPassword" aria-label="Show password">
                                    <span class="eye-open" aria-hidden="true">👁️</span>
                                    <span class="eye-closed d-none" aria-hidden="true">🙈</span>
                                </button>
                            </div>
                            <!-- Password Rules -->
                            <div class="form-text mt-2" id="pw-help">
                                <div class="fw-semibold">Your password must include:</div>
                                <ul class="list-unstyled small mb-0" id="pw-checklist">
                                    <li data-check="len">❌ 8–64 characters</li>
                                    <li data-check="upper">❌ At least one UPPERCASE letter</li>
                                    <li data-check="lower">❌ At least one lowercase letter</li>
                                    <li data-check="digit">❌ At least one digit</li>
                                </ul>
                            </div>
                            <span asp-validation-for="Input.NewPassword" class="text-danger small"></span>
                        </div>

                        <!-- Confirm New Password -->
                        <div class="mb-3">
                            <label asp-for="Input.ConfirmPassword" class="form-label fw-semibold"></label>
                            <div class="input-group">
                                <input asp-for="Input.ConfirmPassword" type="password" autocomplete="new-password" class="form-control" />
                                <button type="button" class="btn btn-outline-secondary toggle-password"
                                        data-target="Input_ConfirmPassword" aria-label="Show password">
                                    <span class="eye-open" aria-hidden="true">👁️</span>
                                    <span class="eye-closed d-none" aria-hidden="true">🙈</span>
                                </button>
                            </div>
                            <span asp-validation-for="Input.ConfirmPassword" class="text-danger small"></span>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between mt-4">
                            <a asp-page="/Index" class="btn btn-outline-secondary px-4">Cancel</a>
                            <button type="submit" class="btn btn-primary px-4">Change Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<partial name="_ValidationScriptsPartial" />

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Eye toggle (same as Login)
            document.querySelectorAll('.toggle-password').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    const targetId = btn.getAttribute('data-target');
                    const input = document.getElementById(targetId);
                    if (!input) return;
                    const show = input.type === 'password';
                    input.type = show ? 'text' : 'password';
                    btn.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
                    btn.querySelector('.eye-open').classList.toggle('d-none', show);
                    btn.querySelector('.eye-closed').classList.toggle('d-none', !show);
                });
            });

            // New password live rules
            const newPwd = document.getElementById('Input_NewPassword');
            const checks = {
                len:       val => val.length >= 8 && val.length <= 64,
                upper:     val => /[A-Z]/.test(val),
                lower:     val => /[a-z]/.test(val),
                digit:     val => /\d/.test(val),
            };
            const items = {};
            document.querySelectorAll('#pw-checklist li').forEach(li => {
                items[li.dataset.check] = li;
            });

            const updateChecklist = () => {
                const v = newPwd.value || '';
                Object.keys(checks).forEach(key => {
                    const ok = checks[key](v);
                    // For 'invalid' check, ok=true means no invalids; word it positively
                    const li = items[key];
                    li.textContent = (ok ? '✅ ' : '❌ ') + li.textContent.replace(/^✅ |^❌ /, '');
                    if (key === 'invalid') {
                        li.firstChild && (li.firstChild.textContent = (ok ? '✅ ' : '❌ '));
                    }
                });
            };

            if (newPwd) {
                newPwd.addEventListener('input', updateChecklist);
                updateChecklist();
            }
        });
    </script>
}                     