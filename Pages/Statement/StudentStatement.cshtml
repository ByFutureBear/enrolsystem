@page
@model OnlineEnrolmentSystem.Pages.Statement.StudentStatementModel
@using System

@{
    ViewData["Title"] = "Student Statement";
    string fmtDate(DateTime? d) => d.HasValue ? d.Value.ToString("yyyy-MM-dd") : "";
}

<div class="container my-4">

    <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">@ViewData["Title"]</h5>

        <!-- Download PDF -->
        <form method="post" asp-page-handler="DownloadPdf">
            <button type="submit" class="btn btn-outline-primary btn-sm">
                Download PDF
            </button>
        </form>
    </div>

    <!-- Student Info -->
    <div class="card mt-3 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-3 text-muted">Student Info</h6>
            @if (Model.StudentInfo != null)
            {
                <div class="row g-2">
                    <div class="col-md-4"><strong>Name:</strong> @Model.StudentInfo.Name</div>
                    <div class="col-md-4"><strong>Email:</strong> @Model.StudentInfo.Email</div>
                    <div class="col-md-4"><strong>Student ID:</strong> @Model.StudentInfo.StudentId</div>
                </div>
            }
            else
            {
                <div class="alert alert-warning mb-0">
                    Couldn’t load student info. Please ensure you’re logged in as a student account.
                </div>
            }
        </div>
    </div>

    <!-- Filters -->
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-3 text-muted">Filter by Date</h6>
            <form method="get" class="row g-3 align-items-end">
                <div class="col-sm-4">
                    <label class="form-label">Start date</label>
                    <input type="date" name="StartDate" class="form-control" value="@fmtDate(Model.StartDate)" />
                </div>
                <div class="col-sm-4">
                    <label class="form-label">End date</label>
                    <input type="date" name="EndDate" class="form-control" value="@fmtDate(Model.EndDate)" />
                </div>
                <div class="col-sm-4 d-flex gap-2">
                    <button class="btn btn-primary" type="submit">Apply</button>
                    <a class="btn btn-outline-secondary" href="@Url.Page("StudentStatement")">Reset</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Enrolments -->
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-3 text-muted">Enrolments</h6>

            @if (Model.Enrolments?.Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-sm">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Section</th>
                                <th>Credits</th>
                                <th>Enrolment Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var e in Model.Enrolments)
                            {
                                <tr>
                                    <td>@e.Class.Course.CourseCode - @e.Class.Course.CourseName</td>
                                    <td>@e.Class.Section</td>
                                    <td>@e.Class.Course.Credits</td>
                                    <td>@e.EnrolmentDate.ToString("dd/MM/yyyy")</td>
                                    <td>@e.Status</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-muted">No enrolments found for the selected dates.</div>
            }
        </div>
    </div>

    <!-- Payments -->
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-3 text-muted">Payments</h6>

            @if (Model.Payments?.Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-sm">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in Model.Payments)
                            {
                                <tr>
                                    <td>@p.PaymentDate.ToString("dd/MM/yyyy")</td>
                                    <td>@p.Amount.ToString("C")</td>
                                    <td>@p.Status</td>
                                    <td>@p.PaymentMethod</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-muted">No payments found for the selected dates.</div>
            }
        </div>
    </div>

    <!-- Summary -->
    <div class="card mt-4 mb-5 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-3 text-muted">Summary</h6>
            <div class="row g-3">
                <div class="col-sm-4">
                    <div class="p-3 border rounded-3">
                        <div class="small text-muted">Total Fees</div>
                        <div class="fw-bold">@Model.TotalFees.ToString("C")</div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="p-3 border rounded-3">
                        <div class="small text-muted">Total Paid</div>
                        <div class="fw-bold">@Model.TotalPaid.ToString("C")</div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="p-3 border rounded-3">
                        <div class="small text-muted">Outstanding Balance</div>
                        <div class="fw-bold">@Model.OutstandingBalance.ToString("C")</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


